
name: refresh-data

on:
  schedule:
  # 23:00–05:00 UTC → 10:00–16:00 AEST (non-DST)
  - cron: '*/10 23,0-6 * * 1-5'
  push:
    branches: [main, master]
  pull_request:
    branches: [main, master]
  workflow_dispatch:

 
jobs:
  nairu:
    runs-on: ubuntu-latest

    env:
      GITHUB_PAT: ${{ secrets.GITHUB_TOKEN }}   # lets git commit without extra PAT

    steps:
      - name: Check out repo
        uses: actions/checkout@v4

      - name: Set up R
        uses: r-lib/actions/setup-r@v2

      - name: Install system libs for rstan
        run: |
          sudo apt-get update
          sudo apt-get install -y build-essential gfortran \
              libcurl4-openssl-dev libssl-dev libxml2-dev

      - name: Restore R packages via renv
        uses: r-lib/actions/setup-renv@v2

      - name: Run NAIRU script
        run: Rscript R/run_nairu.R

      - name: Commit & push new output (if changed)
        run: |
          git config --global user.email "action@github.com"
          git config --global user.name  "GitHub Action"
          git add output/*.csv         # add figures too if you generate any
          git diff --cached --quiet || git commit -m "Daily NAIRU $(date -u +'%Y-%m-%d')"
          git push
